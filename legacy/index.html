<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>主页 - 应用集</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .card-shadow { box-shadow: 0 10px 30px rgba(0,0,0,.06), 0 2px 6px rgba(0,0,0,.04); }
  </style>
</head>
<body class="min-h-screen bg-white text-neutral-900 antialiased">
  <header class="sticky top-0 z-40 backdrop-blur bg-white/70 border-b border-neutral-100">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <div class="flex-1 flex items-center gap-2">
        <div class="w-8 h-8 rounded-2xl bg-neutral-900 text-white grid place-items-center">🧩</div>
        <h1 class="text-xl md:text-2xl font-semibold tracking-tight">主页</h1>
      </div>
      <div class="flex items-center gap-2">
        <span id="userInfo" class="hidden text-sm text-neutral-600"></span>
        <button id="loginBtn" class="rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm hover:bg-neutral-50">登录</button>
        <button id="logoutBtn" class="hidden rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm hover:bg-neutral-50">退出</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8">
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
      <a href="time_line.html" class="group relative rounded-2xl soft-gradient card-shadow p-6 md:p-8 block overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-neutral-50 to-transparent"></div>
        <div class="relative z-10">
          <div class="w-12 h-12 rounded-2xl bg-neutral-900 text-white grid place-items-center mb-4">⏱</div>
          <h2 class="text-lg md:text-xl font-semibold mb-2">时间线 Timeline</h2>
          <p class="text-neutral-600 text-sm">管理你的主题与事件，支持多端同步与搜索筛选。</p>
        </div>
      </a>
    </section>
  </main>

  <script>
    let supabase = null;
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');

    // 初始化 Supabase
    async function initSupabase() {
      try {
        const response = await fetch('/api/config.js');
        const config = await response.json();
        if (config.supabaseUrl && config.supabaseAnonKey && window.supabase) {
          supabase = window.supabase.createClient(config.supabaseUrl, config.supabaseAnonKey);
          return true;
        }
        return false;
      } catch (error) {
        console.error('初始化 Supabase 失败:', error);
        return false;
      }
    }

    function updateAuthUI(user){
      const loggedIn = !!user;
      if (loggedIn){
        loginBtn?.classList.add('hidden');
        logoutBtn?.classList.remove('hidden');
        if (userInfo){
          const name = user.user_metadata?.name || user.email || user.id;
          userInfo.textContent = `已登录：${name}`;
          userInfo.classList.remove('hidden');
        }
      } else {
        logoutBtn?.classList.add('hidden');
        loginBtn?.classList.remove('hidden');
        userInfo?.classList.add('hidden');
        if (userInfo) userInfo.textContent = '';
      }
    }

    async function init(){
      const supabaseReady = await initSupabase();
      if (!supabaseReady) return;
      
      const { data: { session } } = await supabase.auth.getSession();
      updateAuthUI(session?.user || null);
      supabase.auth.onAuthStateChange((_event, session)=>{
        updateAuthUI(session?.user || null);
      });
    }

    loginBtn?.addEventListener('click', async ()=>{
      if (!supabase){ alert('未配置 Supabase'); return; }
      const redirectTo = window.location.origin + window.location.pathname;
      const { error } = await supabase.auth.signInWithOAuth({ provider: 'github', options: { redirectTo } });
      if (error) alert('登录失败：' + error.message);
    });
    logoutBtn?.addEventListener('click', async ()=>{
      if (!supabase) return;
      const { error } = await supabase.auth.signOut();
      if (error) alert('退出失败：' + error.message);
    });

    init();
  </script>
</body>
</html>


