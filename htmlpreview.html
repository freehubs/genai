<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>HTML Preview Â· Apple-style</title>
  <style>
    :root{
      --bg:#0b0c0f;            /* èƒŒæ™¯ */
      --panel:#0f1115;         /* é¢æ¿ */
      --panel-2:#111319;
      --card:#0c0e13;          /* å¡ç‰‡ */
      --text:#e9ecf1;          /* ä¸»è¦æ–‡å­— */
      --muted:#a7b0c2;         /* æ¬¡çº§æ–‡å­— */
      --accent:#007aff;        /* iOS è“ */
      --border:rgba(255,255,255,.08);
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.04) inset;
      --glass:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      --code:#ced7e8;
    }
    [data-theme="light"]{
      --bg:#f5f7fb; --panel:#ffffff; --panel-2:#f7f8fb; --card:#ffffff; --text:#0b1220; --muted:#53627a; --accent:#007aff; --border:rgba(0,0,0,.08); --shadow:0 10px 30px rgba(0,0,0,.06), 0 1px 0 rgba(255,255,255,.6) inset; --code:#0b1220;
    }

    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif; -webkit-font-smoothing:antialiased; display:flex; flex-direction:column; gap:14px; padding:12px; }

    /* é¡¶æ  */
    .toolbar{position:sticky; top:0; z-index:30; display:flex; align-items:center; gap:12px; padding:10px 12px; background:var(--panel); border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow);}
    .title{font-weight:800; letter-spacing:.3px; font-size:clamp(16px,2.2vw,22px)}
    .grow{flex:1}
    .btn{appearance:none; border:none; border-radius:12px; padding:9px 12px; background:var(--panel-2); color:var(--text); border:1px solid var(--border); font-weight:600; display:inline-flex; align-items:center; gap:8px; cursor:pointer}
    .btn.primary{background:var(--accent); color:#fff; border:1px solid rgba(0,0,0,.12)}
    .btn.ghost{background:transparent}
    .btn:active{transform:translateY(1px)}
    .kbd{font:600 12px/1.2 monospace; padding:3px 6px; border-radius:6px; background:rgba(127,127,127,.15); border:1px solid var(--border)}
    .seg{display:flex; background:var(--panel-2); border:1px solid var(--border); border-radius:12px; overflow:hidden}
    .seg button{padding:8px 10px; border:0; background:transparent; color:var(--muted)}
    .seg button.active{background:var(--panel); color:var(--text)}
    .switch{display:inline-flex; align-items:center; gap:8px}
    .switch input{width:42px; height:24px}
    input[type="file"]{display:none}
    label.file{cursor:pointer}

    /* åˆ†æ åŒºåŸŸ */
    .split{flex:1; min-height:0; display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .pane{background:var(--panel); border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow); position:relative; display:flex; flex-direction:column; min-height:200px}
    .pane header{display:flex; align-items:center; justify-content:space-between; padding:8px 12px; border-bottom:1px solid var(--border); background:var(--glass); border-top-left-radius:20px; border-top-right-radius:20px}
    .pane header .right{display:flex; align-items:center; gap:8px}

    /* ç¼–è¾‘å™¨ */
    .editor{flex:1; min-height:120px; resize:none; border:0; outline:none; background:transparent; color:var(--code); padding:14px; font:500 13.5px/1.6 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; caret-color:var(--accent)}
    .status{position:absolute; right:12px; bottom:10px; color:var(--muted); font-size:12px}

    /* é¢„è§ˆ */
    .preview-wrap{position:relative; flex:1; min-height:140px;}
    iframe.preview{position:absolute; inset:0; width:100%; height:100%; border:0; border-bottom-left-radius:20px; border-bottom-right-radius:20px; background:#fff}

    /* æ‹–åŠ¨åˆ†éš”æ¡ */
    .resizer{position:absolute; top:0; bottom:0; width:10px; right:-6px; cursor:col-resize}

    /* åº•éƒ¨æç¤º */
    .hint{opacity:.8; color:var(--muted); font-size:12px; text-align:center}

    /* å…¨å±è¾…åŠ© */
    .fs-btn{border-radius:10px}

    /* å“åº”å¼ */
    @media (max-width:900px){ .split{grid-template-columns:1fr; grid-template-rows:1fr 1fr} }

    @supports(padding:max(0px)){
      body{padding-bottom:calc(12px + env(safe-area-inset-bottom))}
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="title">HTML Preview</div>
    <div class="seg" role="tablist" aria-label="layout">
      <button class="active" id="layoutSplit" title="å¹¶æ’">å¹¶æ’</button>
      <button id="layoutPreview" title="ä»…é¢„è§ˆ">ä»…é¢„è§ˆ</button>
      <button id="layoutEditor" title="ä»…ç¼–è¾‘">ä»…ç¼–è¾‘</button>
    </div>
    <div class="grow"></div>

    <label for="file" class="btn ghost file" title="æ‰“å¼€ .html æ–‡ä»¶">æ‰“å¼€æ–‡ä»¶</label>
    <input type="file" id="file" accept="text/html,.html,.htm" />

    <button class="btn" id="save">ä¿å­˜</button>
    <button class="btn primary" id="run">è¿è¡Œ <span class="kbd">âŒ˜â†µ</span></button>

    <div class="switch">
      <span class="kbd">âŒ˜/</span>
      <label><input type="checkbox" id="live"> å®æ—¶é¢„è§ˆ</label>
    </div>

    <div class="switch">
      <label><input type="checkbox" id="themeToggle"> æµ…è‰²</label>
    </div>
  </div>

  <div class="split" id="split">
    <section class="pane" id="paneEditor" aria-label="Editor">
      <header>
        <strong>ç¼–è¾‘å™¨</strong>
        <div class="right">
          <button class="btn ghost" id="fmt">æ ¼å¼åŒ–</button>
          <button class="btn ghost" id="insert">æ’å…¥æ¨¡æ¿</button>
        </div>
      </header>
      <textarea id="editor" class="editor" spellcheck="false" placeholder="åœ¨æ­¤ç²˜è´´æˆ–ç¼–å†™ HTMLâ€¦"></textarea>
      <div class="status" id="status">å·²å°±ç»ª</div>
      <div class="resizer" id="resizer" title="æ‹–åŠ¨è°ƒæ•´å·¦å³å®½åº¦"></div>
    </section>

    <section class="pane" id="panePreview" aria-label="Preview">
      <header>
        <strong>é¢„è§ˆ</strong>
        <div class="right">
          <button class="btn ghost fs-btn" id="fsApp">åº”ç”¨å…¨å±</button>
          <button class="btn ghost fs-btn" id="fsIframe">é¢„è§ˆå…¨å±</button>
          <button class="btn ghost" id="reload">åˆ·æ–°</button>
        </div>
      </header>
      <div class="preview-wrap">
        <iframe id="preview" class="preview" title="HTML é¢„è§ˆ" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
      </div>
    </section>
  </div>

  <p class="hint">æç¤ºï¼šæŒ‰ <span class="kbd">âŒ˜â†µ</span> è¿è¡Œï¼›<span class="kbd">âŒ˜/</span> åˆ‡æ¢å®æ—¶é¢„è§ˆï¼›æ”¯æŒæ‹–åŠ¨ä¸­é—´åˆ†éš”çº¿æ”¹å˜ä¸¤ä¾§å®½åº¦ï¼›æ”¯æŒå…¨å±é¢„è§ˆã€‚</p>

  <script>
    const $ = s => document.querySelector(s);
    const editor = $('#editor');
    const frame = $('#preview');
    const statusEl = $('#status');

    const initial = `<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hello Apple Style</title>
  <style>
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif; display:grid; place-items:center; min-height:100vh; background:linear-gradient(135deg,#f5f7ff,#eef2ff)}
    .card{background:#fff; padding:28px 26px; border-radius:18px; box-shadow:0 20px 40px rgba(0,0,0,.08)}
    h1{margin:0 0 6px; font-size:32px}
    p{margin:0; color:#42526e}
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ Hello, world!</h1>
    <p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ¨¡æ¿ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ HTML / CSS / JSã€‚</p>
  </div>
</body>
</html>`;

    editor.value = initial;

    // è¿è¡Œ/æ³¨å…¥åˆ° iframe
    function run(){
      const html = editor.value;
      const blob = new Blob([html], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      frame.src = url; // ä½¿ç”¨ blob URLï¼Œé¿å… srcdoc çš„æŸäº› CSP é™åˆ¶
      status('å·²è¿è¡Œ');
      setTimeout(()=> URL.revokeObjectURL(url), 30000);
    }

    function status(t){ statusEl.textContent = t }

    // å®æ—¶é¢„è§ˆ
    const live = $('#live');
    let liveTimer;
    function schedule(){ if(!live.checked) return; clearTimeout(liveTimer); liveTimer = setTimeout(run, 350) }
    editor.addEventListener('input', schedule);

    // æ‰‹åŠ¨è¿è¡Œ
    $('#run').addEventListener('click', run);

    // åˆ·æ–° iframeï¼ˆä¸æ”¹å˜å†…å®¹ï¼‰
    $('#reload').addEventListener('click', ()=>{ frame.contentWindow?.location.reload() })

    // æ‰“å¼€/ä¿å­˜
    $('#file').addEventListener('change', async (e)=>{
      const f = e.target.files?.[0]; if(!f) return; const txt = await f.text(); editor.value = txt; run(); status(`å·²æ‰“å¼€ï¼š${f.name}`);
    });
    $('#save').addEventListener('click', ()=>{
      const blob = new Blob([editor.value], {type:'text/html'});
      const a = document.createElement('a'); a.download = 'index.html'; a.href = URL.createObjectURL(blob); a.click(); setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
      status('å·²ä¿å­˜ä¸º index.html');
    });

    // æ¨¡æ¿ä¸æ ¼å¼åŒ–ï¼ˆç®€å•ç¼©è¿›ï¼‰
    $('#insert').addEventListener('click', ()=>{ editor.value = initial; run(); });
    $('#fmt').addEventListener('click', ()=>{ editor.value = pretty(editor.value); schedule(); status('å·²æ ¼å¼åŒ–') });

    // å¸ƒå±€åˆ‡æ¢
    const split = $('#split');
    $('#layoutSplit').onclick = ()=>{ split.style.gridTemplateColumns = '1fr 1fr'; setActive('layoutSplit') };
    $('#layoutPreview').onclick = ()=>{ split.style.gridTemplateColumns = '0fr 1fr'; setActive('layoutPreview') };
    $('#layoutEditor').onclick = ()=>{ split.style.gridTemplateColumns = '1fr 0fr'; setActive('layoutEditor') };
    function setActive(id){ document.querySelectorAll('.seg button').forEach(b=> b.classList.toggle('active', b.id===id)) }

    // ä¸»é¢˜
    const themeToggle = $('#themeToggle');
    function applyTheme(){ document.documentElement.setAttribute('data-theme', themeToggle.checked? 'light':'dark') }
    themeToggle.addEventListener('change', applyTheme); applyTheme();

    // å…¨å±ï¼ˆåº”ç”¨ & Iframeï¼‰
    $('#fsApp').addEventListener('click', ()=>{
      (document.documentElement.requestFullscreen || document.documentElement.webkitRequestFullscreen)?.call(document.documentElement);
    });
    $('#fsIframe').addEventListener('click', ()=>{
      (frame.requestFullscreen || frame.webkitRequestFullscreen)?.call(frame);
    });

    // æ‹–åŠ¨è°ƒæ•´å·¦å³å®½åº¦
    (function resizable(){
      const resizer = $('#resizer'); const paneLeft = $('#paneEditor'); let dragging=false, startX=0, startCols=[1,1];
      resizer.addEventListener('mousedown', (e)=>{ dragging=true; startX=e.clientX; const gcs=getComputedStyle(split).gridTemplateColumns.split(' '); startCols=[parseFloat(gcs[0]), parseFloat(gcs[2]||1)] ; document.body.style.userSelect='none' });
      addEventListener('mousemove', (e)=>{ if(!dragging) return; const dx=e.clientX-startX; const total=split.clientWidth; const left = Math.max(240, split.clientWidth*(startCols[0]/(startCols[0]+startCols[1])) + dx); const right = total-left; split.style.gridTemplateColumns = left+'px '+right+'px'; });
      addEventListener('mouseup', ()=>{ dragging=false; document.body.style.userSelect='' });
    })();

    // é”®ç›˜å¿«æ·é”®
    addEventListener('keydown', (e)=>{
      if((e.metaKey||e.ctrlKey) && e.key === 'Enter'){ e.preventDefault(); run(); }
      if((e.metaKey||e.ctrlKey) && e.key === '/'){ e.preventDefault(); live.checked = !live.checked; schedule(); }
    });

    // åˆæ¬¡è¿è¡Œ
    run();

    // ç®€å•æ ¼å¼åŒ–ï¼ˆéå¸¸åŸºç¡€ï¼‰
    function pretty(html){
      try{
        // åŸºäºç¼©è¿›çš„ç®€æ˜“ç¾åŒ–å™¨ï¼ˆä¸è§£æ script/style å†…éƒ¨ï¼‰
        const lines = html.replace(/>\s+</g, '><').replace(/</g, '\n<').split(/\n+/).filter(Boolean);
        const out=[]; let pad=0; const indent = s => '  '.repeat(s);
        for(const l of lines){
          if(/^<\//.test(l)) pad=Math.max(pad-1,0);
          out.push(indent(pad)+l);
          if(/^<([a-zA-Z0-9-]+)(?!.*\/>).*?>$/.test(l) && !/^<(meta|link|base|br|img|hr|input|source|area|col|param|track)\b/.test(l)) pad++;
        }
        return out.join('\n');
      }catch(e){ return html }
    }
  </script>
</body>
</html>
